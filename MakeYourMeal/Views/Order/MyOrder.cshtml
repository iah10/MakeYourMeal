@using MakeYourMeal.Data.Models
@model IEnumerable<MakeYourMeal.Data.Models.Order>

@{
	ViewBag.Title = "My Order";
	int i = 1;
}
<!DOCTYPE html>
<html>
<head>
	<title>My Order</title>
</head>
<body class="myorder-page">
	<div class="myorder-page-container">
		<h1>My Orders</h1>

		@{
			foreach (var order in Model)
			{
				<div class="sheet-container">
					<h3> Order @i</h3>

					<ul>
						@foreach (var ing in order.OrderItems)
						{
							<li> 
								<span>@ing.FoodItemName</span>

								<p>+ Extra(
									@foreach (var change in @ing.ExtraIngredients)
									{
										<span>@change.Name</span>
									})
								</p>

								<p>- Without(
									@foreach (var change in @ing.WithoutIngredients)
									{
										<span>@change.Name</span>
									})
								</p>
							</li>
							
							if (order.OrderState.State.Equals(OrderState.NEW_ORDER))
							{

								<span>@Html.ActionLink("Delete Order Item", "DeleteOrderItem", new { id = ing.OrderItemId }, htmlAttributes: new { @class = "btn", @role = "button" })</span>
							}
						}
					</ul>

					<div>
						<dl class="dl-horizontal ">
							<dt>
								@Html.DisplayNameFor(o => o.TableNumber)
							</dt>

							<dd>
								@Html.DisplayFor(o => order.TableNumber)
							</dd>

							<dt>
								@Html.DisplayNameFor(o => o.OrderedAt)
							</dt>

							<dd>
								@Html.DisplayFor(o => order.OrderedAt)
							</dd>

							<dt>
								@Html.DisplayNameFor(o => o.TotalCost)
							</dt>

							<dd>
								@Html.DisplayFor(o => order.TotalCost)
							</dd>

							<dt>
								@Html.DisplayNameFor(o => o.State)
							</dt>

							<dd>
								@Html.DisplayFor(o => order.State)
							</dd>

						</dl>
					</div>

					@if (order.OrderState.State.Equals(OrderState.NEW_ORDER))
					{
						@Html.ActionLink("Commit Order", "CommitCurrentOrder")
					}
				</div>
			}
		}
	</div>

	<div class="footer">
		<p>
			@Html.ActionLink("Back to List", "Index", "FoodItems", htmlAttributes: new { @class = "btn", @role = "button" })
		</p>
	</div>

	@section scripts
{

		<script src="~/Scripts/jquery.signalR-2.2.0.js"></script>
		<script type="text/javascript" src="~/signalr/hubs"></script>
		<script src="~/Scripts/knockout-3.3.0.js"></script>
		<script src="~/Scripts/toastr.min.js"></script>
		<script>
			$(function () {

				//start hub
				var hub = $.connection.customersHub;

				//order receivied
				hub.client.orderStateChanged = function (state) {
					toastr.info("Your Order Is Now " + state);
				}

				//start real time connection
				$.connection.hub.start().done(function () {
					hub.server.registerConId(@ViewBag.TableNumber);
				});
			});
		</script>
	}
</body>
</html>
